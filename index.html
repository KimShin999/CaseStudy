<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>gunny Fake</title>
    <link rel="stylesheet" href="gamegunnyFake.css">
</head>
<body>

<canvas id = "mygunny" style="border: 2px solid #d3d3d3" ></canvas>
    <script>
        let paincanvas = document.getElementById("mygunny");
        let ctx = paincanvas.getContext("2d");
        let currentPlayer = 0;

        let sound =function () {
            danban = new Audio("audio/danbann.wav");
            danban.play();
        }

        let thaydoigoc = function (evt) {
            switch (evt.keyCode) {
                case 38:
                    if (currentPlayer ===0){
                        gocbans[currentPlayer].alpha += Math.PI/180;
                    } else
                    if (currentPlayer ===1){
                        gocbans[currentPlayer].alpha -= Math.PI/180;
                    }
                    break;
                case 40:
                    if (currentPlayer ===0){
                        gocbans[currentPlayer].alpha -= Math.PI/180;
                    } else
                    if (currentPlayer ===1){
                        gocbans[currentPlayer].alpha += Math.PI/180;
                    }
                    break
                case 32:
                    if (bullets[0].isFire) return;          // nếu thằng nhân vật 1 bắn thì thằng 2 k được bắn
                    if (bullets[1].isFire) return;          //
                    if (currentPlayer ===0){
                        sound();
                        bullets[currentPlayer] = new bullet(nhanvat1.x,nhanvat1.y,20,gocbans[currentPlayer].alpha,40)
                        bullets[currentPlayer].fire();
                        currentPlayer = 1;
                    } else
                    if (currentPlayer ===1){
                        sound();
                        bullets[currentPlayer] = new bullet(nhanvat2.x,nhanvat2.y,20,gocbans[currentPlayer].alpha,40);
                        bullets[currentPlayer].fire();
                        currentPlayer = 0;
                    }

                case 107:                                   //hack máu
                    if (bullets[0].isFire) return;
                    if (bullets[1].isFire) return;
                    if (currentPlayer===0){
                        nhanvat1.mau +=20;
                        currentPlayer = 1;
                    }else
                    if(currentPlayer===1){
                        nhanvat2.mau +=20;
                        currentPlayer = 0;
                    }
            }
        }

        window.addEventListener("keydown",thaydoigoc)
        paincanvas.width = window.innerWidth;
        paincanvas.height = window.innerHeight;


        let nhanvat = function (x,y,tenhinhanh, cao,rong, mau) {   //nhân vật-----------------
            this.x = x;
            this.y = y;
            this.yy += 170
            this.cao = cao;
            this.rong = rong;
            this.mau = mau;
            this.image = new Image();
            this.image.src = tenhinhanh;


            this.creatnhanvat = function () {
                ctx.drawImage(this.image,this.x,this.y,this.cao,this.rong)
            }

            this.showmau = function () {
                ctx.beginPath();
                ctx.fillStyle = "#FF0000"
                ctx.fillRect(this.x + 25, 620,this.mau, 10);
                ctx.stroke();
            }

            this.checkdie = function () {
                if(this.mau === 0){
                    this.image.src = "anh/die.png"
                    bullets[currentPlayer].image.src = " ";

                }
            }

        }

        nhanvat1 = new nhanvat(280,650,"anh/Role1.png",150,150,100);
        nhanvat2 = new nhanvat(1850,650,"anh/DungCuHocTap.png",150,150,100);

        nhanvat1.creatnhanvat();
        nhanvat2.creatnhanvat();


        let gocban = function(x,y,alpha){              //tạo góc bắn--------------------
            this.x = x+75;
            this.y = y+75;
            this.alpha = alpha

            this.xgoc =  this.x+Math.cos(this.alpha)*200;
            this.ygoc = this.y-Math.sin(this.alpha)*200;

            this.paingocban = function(){
                this.xgoc =  this.x+Math.cos(this.alpha)*200;
                this.ygoc = this.y-Math.sin(this.alpha)*200;
            ctx.moveTo(this.x,this.y);         //vẽ đường căn góc
            ctx.lineTo(this.xgoc,this.ygoc);
            ctx.stroke();
            }
        }

        let gocbans = [];
        gocbans[0] = new gocban(nhanvat1.x,nhanvat1.y,Math.PI/4);
        gocbans[1] = new gocban(nhanvat2.x,nhanvat2.y,3*Math.PI/4);


        let bullet = function (x ,y, R, alpha, velocity) {         //Đạn----------------------
            this.x = x+75;
            this.y = y+75;
            this.xx = x + 75; //lưu vị trí đạn
            this.yy = y + 75; //lưu vị trí đạn
            this.R = R;
            this.alpha = alpha;
            this.velocity = velocity; //lực bắn
            this.Vx = 0;
            this.Vy = 0;
            this.isFire = false;

            this.image= new Image();
            this.image.src = "anh/BMR.png";

            this.creatBullet = function () {
                ctx.beginPath();
                ctx.drawImage(this.image,this.x-50,this.y,100,100)
                ctx.closePath();
            }


            this.fire = function () {
                let turnCheck = currentPlayer===0?1:0;
                if (bullets[turnCheck].isFire) return
                this.Vx = this.velocity * Math.cos(this.alpha);
                this.Vy = -this.velocity * Math.sin(this.alpha);
                this.isFire = true;
            }

            this.position = function () {
                if (!this.isFire) return;
                this.x += this.Vx;
                this.y += this.Vy;
                this.Vy += 1
            }

            this.move = function () {
                this.position();
                this.creatBullet();
            }

            this.kiemtravacham = function(nhanvat) {
                let distant = (this.x - nhanvat.x-75)*(this.x - nhanvat.x-75) + (this.y - nhanvat.y-75)*(this.y - nhanvat.y-75);
                let R = 100*100
                if(distant < R ){

                    hinhanhvachams = new hinhanhvacham(this.x, this.y, 200);
                    hinhanhvachams.startTime = Date.now();
                    hinhanhvachams.isExist = true;

                    this.x = this.xx;
                    this.y = this.yy;
                    this.Vy = 0;

                    nhanvat.mau -= 40;                      //va chạm mất máu
                    if (nhanvat.mau < 0){
                        nhanvat.mau=0
                    }

                    this.isFire = false;
                }

                if (this.x < 0 || this.x > paincanvas.width || this.y > paincanvas.height ){
                    hinhanhvachams = new hinhanhvacham(this.x, this.y, 200);
                    hinhanhvachams.startTime = Date.now();
                    hinhanhvachams.isExist = true;

                    this.x = this.xx;
                    this.y = this.yy;
                    this.Vy = 0;
                    this.isFire = false;
                }
            }
        }

        let bullets = [];
        bullets[0] = new bullet(nhanvat1.x,nhanvat1.y,20,gocbans[0].alpha,40);
        bullets[1] = new bullet(nhanvat2.x,nhanvat2.y,20,gocbans[1].alpha,40);


        let hinhanhvacham = function(x,y,r){
            this.x = x;
            this.y = y;
            this.R = r;
            this.isExist = false;
            this.startTime;
            this.endTime;
            this.image = new Image();
            this.image.src = "anh/haha.png"

            this.show = function () {
                if (!this.isExist) return;
                this.endTime = Date.now();
                if (this.endTime - this.startTime >500)
                    this.isExist = false;
                ctx.beginPath()
                ctx.drawImage(this.image,this.x-150,this.y-50,250,250)
                ctx.closePath()
            }
        }
         let hinhanhvachams = new hinhanhvacham(0,0,0)





        function update() {                                                 //hàm update
            ctx.clearRect(0, 0,window.innerWidth, window.innerHeight);
            nhanvat1.creatnhanvat();
            nhanvat2.creatnhanvat();
            nhanvat1.showmau();
            nhanvat2.showmau();
            gocbans[0].paingocban();
            gocbans[1].paingocban();
            bullets[0].move();
            bullets[1].move();
            bullets[0].kiemtravacham(nhanvat2)
            bullets[1].kiemtravacham(nhanvat1)
            nhanvat1.checkdie();
            nhanvat2.checkdie();
            hinhanhvachams.show();
        }
        setInterval(update,35);

</script>
</body>
</html>